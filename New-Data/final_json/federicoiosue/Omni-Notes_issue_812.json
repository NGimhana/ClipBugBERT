{
    "url": "https://api.github.com/repos/federicoiosue/Omni-Notes/issues/812",
    "repository_url": "https://api.github.com/repos/federicoiosue/Omni-Notes",
    "labels_url": "https://api.github.com/repos/federicoiosue/Omni-Notes/issues/812/labels{/name}",
    "comments_url": "https://api.github.com/repos/federicoiosue/Omni-Notes/issues/812/comments",
    "events_url": "https://api.github.com/repos/federicoiosue/Omni-Notes/issues/812/events",
    "html_url": "https://github.com/federicoiosue/Omni-Notes/issues/812",
    "id": 777726375,
    "node_id": "MDU6SXNzdWU3Nzc3MjYzNzU=",
    "number": 812,
    "title": "Lost attachment after restore?",
    "user": {
        "login": "tappdesign",
        "id": 59613279,
        "node_id": "MDQ6VXNlcjU5NjEzMjc5",
        "avatar_url": "https://avatars.githubusercontent.com/u/59613279?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tappdesign",
        "html_url": "https://github.com/tappdesign",
        "followers_url": "https://api.github.com/users/tappdesign/followers",
        "following_url": "https://api.github.com/users/tappdesign/following{/other_user}",
        "gists_url": "https://api.github.com/users/tappdesign/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tappdesign/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tappdesign/subscriptions",
        "organizations_url": "https://api.github.com/users/tappdesign/orgs",
        "repos_url": "https://api.github.com/users/tappdesign/repos",
        "events_url": "https://api.github.com/users/tappdesign/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tappdesign/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 283562197,
            "node_id": "MDU6TGFiZWwyODM1NjIxOTc=",
            "url": "https://api.github.com/repos/federicoiosue/Omni-Notes/labels/Bug%20-%20Critical",
            "name": "Bug - Critical",
            "color": "E32525",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "federicoiosue",
        "id": 487104,
        "node_id": "MDQ6VXNlcjQ4NzEwNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/487104?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/federicoiosue",
        "html_url": "https://github.com/federicoiosue",
        "followers_url": "https://api.github.com/users/federicoiosue/followers",
        "following_url": "https://api.github.com/users/federicoiosue/following{/other_user}",
        "gists_url": "https://api.github.com/users/federicoiosue/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/federicoiosue/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/federicoiosue/subscriptions",
        "organizations_url": "https://api.github.com/users/federicoiosue/orgs",
        "repos_url": "https://api.github.com/users/federicoiosue/repos",
        "events_url": "https://api.github.com/users/federicoiosue/events{/privacy}",
        "received_events_url": "https://api.github.com/users/federicoiosue/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "federicoiosue",
            "id": 487104,
            "node_id": "MDQ6VXNlcjQ4NzEwNA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/487104?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/federicoiosue",
            "html_url": "https://github.com/federicoiosue",
            "followers_url": "https://api.github.com/users/federicoiosue/followers",
            "following_url": "https://api.github.com/users/federicoiosue/following{/other_user}",
            "gists_url": "https://api.github.com/users/federicoiosue/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/federicoiosue/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/federicoiosue/subscriptions",
            "organizations_url": "https://api.github.com/users/federicoiosue/orgs",
            "repos_url": "https://api.github.com/users/federicoiosue/repos",
            "events_url": "https://api.github.com/users/federicoiosue/events{/privacy}",
            "received_events_url": "https://api.github.com/users/federicoiosue/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": {
        "url": "https://api.github.com/repos/federicoiosue/Omni-Notes/milestones/22",
        "html_url": "https://github.com/federicoiosue/Omni-Notes/milestone/22",
        "labels_url": "https://api.github.com/repos/federicoiosue/Omni-Notes/milestones/22/labels",
        "id": 4776340,
        "node_id": "MDk6TWlsZXN0b25lNDc3NjM0MA==",
        "number": 22,
        "title": "6.1.0",
        "description": "Under the hood improvements and global dependencies update. Fixing F-Droid build.",
        "creator": {
            "login": "federicoiosue",
            "id": 487104,
            "node_id": "MDQ6VXNlcjQ4NzEwNA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/487104?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/federicoiosue",
            "html_url": "https://github.com/federicoiosue",
            "followers_url": "https://api.github.com/users/federicoiosue/followers",
            "following_url": "https://api.github.com/users/federicoiosue/following{/other_user}",
            "gists_url": "https://api.github.com/users/federicoiosue/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/federicoiosue/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/federicoiosue/subscriptions",
            "organizations_url": "https://api.github.com/users/federicoiosue/orgs",
            "repos_url": "https://api.github.com/users/federicoiosue/repos",
            "events_url": "https://api.github.com/users/federicoiosue/events{/privacy}",
            "received_events_url": "https://api.github.com/users/federicoiosue/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 3,
        "closed_issues": 39,
        "state": "closed",
        "created_at": "2019-10-23T07:33:19Z",
        "updated_at": "2023-03-25T00:36:19Z",
        "due_on": null,
        "closed_at": "2022-03-07T13:19:38Z"
    },
    "comments": 4,
    "created_at": "2021-01-03T22:13:48Z",
    "updated_at": "2021-01-23T14:37:32Z",
    "closed_at": "2021-01-23T14:37:32Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Hi Federico, \r\n\r\nThis is just pretty curious, not sure if you can reproduce it.\r\nYou can check attached video\r\nhttps://user-images.githubusercontent.com/59613279/103489643-417ead00-4e16-11eb-95ba-cb3eb7f26548.mp4\r\n\r\nJust backup all notes, then import it. At a first glance, looks ok, but after restart attachment is lost.\r\n\r\nproblem could be in BackupHelper.java  --> reading old attachments from DB\r\nJust  look at remarks written in CAPS\r\n\r\n```\r\n/**\r\n\t * Imports single note from its file\r\n\t */\r\n\tpublic static Note importNote(File file, CryptoHelper ch) {\r\n\t\tNote note = getImportNote(file, ch);\r\n\t\tif (note.getCategory() != null) {\r\n\t\t\tDbHelper.getInstance().updateCategory(note.getCategory());\r\n\t\t}\r\n\t\t//note.setAttachmentsListOld(DbHelper.getInstance().getNoteAttachments(note)); //  -->  COMMENTED OUT\r\n\t\tDbHelper.getInstance().updateNote(note, false);\r\n\t\treturn note;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Retrieves single note from its file\r\n\t */\r\n\tpublic static Note getImportNote(File file, CryptoHelper ch) {\r\n\t\ttry {\r\n\t\t\tNote note = new Note();\r\n\t\t\tString jsonString = FileUtils.readFileToString(file);\r\n\t\t\tif (!TextUtils.isEmpty(jsonString)) {\r\n\r\n\t\t\t\tString plaintext = ch.decryptText(jsonString, ch.getCipher());\r\n\t\t\t\tif (!plaintext.isEmpty()) {\r\n\t\t\t\t\tnote.buildFromJson(plaintext);\r\n\t\t\t\t\t//note.setAttachmentsListOld(DbHelper.getInstance().getNoteAttachments(note)); //  -->  COMMENTED OUT\r\n\t\t\t\t\tnote.setAttachmentsListOld(new ArrayList<>(note.getAttachmentsList()));   //  NEW ADDED --> JUST COPY THE ATTACHEMNT LIST, TO MAKE IT COMPATIBLE WITH :   deletedAttachments.remove(attachment);  in DBHelper.java\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn note;\r\n\t\t} catch (IOException e) {\r\n\t\t\tLogDelegate.e(\"Error parsing note json\");\r\n\t\t\treturn new Note();\r\n\t\t}\r\n\t}\r\n\r\n```\r\n\r\nthe problem could be caused in DBHelper.java in updateNote() function ...(if AttachmentsListOld() are read from DB)\r\n```\r\n\r\n // Updating attachments\r\n    List<Attachment> deletedAttachments = note.getAttachmentsListOld();\r\n    for (Attachment attachment : note.getAttachmentsList()) {\r\n      updateAttachment(note.get_id() != null ? note.get_id() : values.getAsLong(KEY_CREATION),\r\n          attachment, db);\r\n      deletedAttachments.remove(attachment);  // REMOVING ATTACHMENT WILL FAIL, --> DELETED ATTACHMENTS ARE NOT DECREMENTED\r\n    }\r\n    // Remove from database deleted attachments\r\n    for (Attachment attachmentDeleted : deletedAttachments) {       // DELETEDATTACHMENTS IS NOT EMPTY, IT WILL  BE DELETED FROM DB ACCIDENTALLY\r\n      db.delete(TABLE_ATTACHMENTS, KEY_ATTACHMENT_ID + \" = ?\",\r\n          new String[]{String.valueOf(attachmentDeleted.getId())});\r\n    }\r\n```\r\n\r\nthis test is fair complex, not sure if you can confirm it, and my solution is maybe not the correct one, but at least it could solve this issue on my phone.\r\n",
    "closed_by": {
        "login": "federicoiosue",
        "id": 487104,
        "node_id": "MDQ6VXNlcjQ4NzEwNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/487104?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/federicoiosue",
        "html_url": "https://github.com/federicoiosue",
        "followers_url": "https://api.github.com/users/federicoiosue/followers",
        "following_url": "https://api.github.com/users/federicoiosue/following{/other_user}",
        "gists_url": "https://api.github.com/users/federicoiosue/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/federicoiosue/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/federicoiosue/subscriptions",
        "organizations_url": "https://api.github.com/users/federicoiosue/orgs",
        "repos_url": "https://api.github.com/users/federicoiosue/repos",
        "events_url": "https://api.github.com/users/federicoiosue/events{/privacy}",
        "received_events_url": "https://api.github.com/users/federicoiosue/received_events",
        "type": "User",
        "site_admin": false
    },
    "reactions": {
        "url": "https://api.github.com/repos/federicoiosue/Omni-Notes/issues/812/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/federicoiosue/Omni-Notes/issues/812/timeline",
    "performed_via_github_app": null,
    "state_reason": "completed"
}