{
    "url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/12105",
    "repository_url": "https://api.github.com/repos/ankidroid/Anki-Android",
    "labels_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/12105/labels{/name}",
    "comments_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/12105/comments",
    "events_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/12105/events",
    "html_url": "https://github.com/ankidroid/Anki-Android/pull/12105",
    "id": 1344711693,
    "node_id": "PR_kwDOAHXAE849ef1g",
    "number": 12105,
    "title": "[GSoC] Implement the CSV importer",
    "user": {
        "login": "BrayanDSO",
        "id": 69634269,
        "node_id": "MDQ6VXNlcjY5NjM0MjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/69634269?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BrayanDSO",
        "html_url": "https://github.com/BrayanDSO",
        "followers_url": "https://api.github.com/users/BrayanDSO/followers",
        "following_url": "https://api.github.com/users/BrayanDSO/following{/other_user}",
        "gists_url": "https://api.github.com/users/BrayanDSO/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/BrayanDSO/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/BrayanDSO/subscriptions",
        "organizations_url": "https://api.github.com/users/BrayanDSO/orgs",
        "repos_url": "https://api.github.com/users/BrayanDSO/repos",
        "events_url": "https://api.github.com/users/BrayanDSO/events{/privacy}",
        "received_events_url": "https://api.github.com/users/BrayanDSO/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/milestones/42",
        "html_url": "https://github.com/ankidroid/Anki-Android/milestone/42",
        "labels_url": "https://api.github.com/repos/ankidroid/Anki-Android/milestones/42/labels",
        "id": 6623046,
        "node_id": "MDk6TWlsZXN0b25lNjYyMzA0Ng==",
        "number": 42,
        "title": "2.16 release",
        "description": "",
        "creator": {
            "login": "mikehardy",
            "id": 782704,
            "node_id": "MDQ6VXNlcjc4MjcwNA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/782704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mikehardy",
            "html_url": "https://github.com/mikehardy",
            "followers_url": "https://api.github.com/users/mikehardy/followers",
            "following_url": "https://api.github.com/users/mikehardy/following{/other_user}",
            "gists_url": "https://api.github.com/users/mikehardy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mikehardy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mikehardy/subscriptions",
            "organizations_url": "https://api.github.com/users/mikehardy/orgs",
            "repos_url": "https://api.github.com/users/mikehardy/repos",
            "events_url": "https://api.github.com/users/mikehardy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mikehardy/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 4,
        "closed_issues": 3585,
        "state": "open",
        "created_at": "2021-04-04T15:15:20Z",
        "updated_at": "2023-08-28T20:58:04Z",
        "due_on": null,
        "closed_at": null
    },
    "comments": 8,
    "created_at": "2022-08-19T17:28:02Z",
    "updated_at": "2022-08-25T16:44:57Z",
    "closed_at": "2022-08-25T15:28:55Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "draft": false,
    "pull_request": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/pulls/12105",
        "html_url": "https://github.com/ankidroid/Anki-Android/pull/12105",
        "diff_url": "https://github.com/ankidroid/Anki-Android/pull/12105.diff",
        "patch_url": "https://github.com/ankidroid/Anki-Android/pull/12105.patch",
        "merged_at": "2022-08-25T15:28:55Z"
    },
    "body": "## Purpose / Description\r\nOn top of #12072\r\n\r\n## Fixes\r\nCloses #6772\r\nCloses #9437\r\n\r\n## Approach\r\n\r\nThis implements the base for using upstream's HTML/Js pages directly on AnkiDroid.\r\n\r\nI've used https://github.com/krmanik/Anki-Android/pull/23 as base of this PR. I wouldn't have managed to do it without all the previous work of Mani and Damien, so I thank them very much.\r\n\r\nAs discussed on https://github.com/krmanik/Anki-Android/pull/23, to use an Anki HTML page, we should be able to intercept POST requests. After some proof of concepts made by Mani, the conclusion was that hosting a local server, like the desktop application, may be most suitable approach.\r\n\r\nTo create the local server, I've used the same approach of https://github.com/krmanik/Anki-Android/pull/23 and added NanoHTTPD, a java server library, as dependency. I don't have experience with any Java server libraries, so I can't tell with confidence if this is *the best library*, but it seemed solid to me and already had a working model on Mani's PR, so using it looked like the best choice for the moment.\r\n\r\nBesides the server, this PR implements the base classes for creating AnkiPages. Each page can easily extend `PageFragment` and define what it needs. I've tried using the new Statistics, Card Info, Deck Options pages and they work well. Try https://github.com/BrayanDSO/Anki-Android/tree/csvImporterOtherPages if you want to test them (the deck options screen may need some extra work).\r\n\r\nFinally, the CSV importer page and its endpoints are implemented and can be used with the new backend.\r\n\r\n**PENDING (for future PRs):**\r\n- Close the Import dialog after the taps \"OK\" on the progress dialog\r\n- Inject CSS to match the themes' colors\r\n- ~~Maybe hide the file path with CSS/Js, because it may be big and there isn't much horizontal space in phone screens on portrait mode~~ (already on upstream)\r\n- Not for my GSoC project, but the other screens could be implemented too, as they are mostly done, so other people could test/work on them as well\r\n\r\n## How Has This Been Tested?\r\n\r\nNOTICE: this needs an updated WebView (77+) to work correctly (see https://github.com/ankidroid/Anki-Android/issues/6772#issuecomment-1209212058 and the comments below for discussion), which shouldn't be a problem as the project's minSdk (21) supports it. But if you are testing on a emulator, be aware that the WebView shipped on some older SDK versions may be an old version, so either update the WebView or use a newer SDK.\r\n\r\nNOTICE 2: there may be a flickering issue after remapping fields, but that was already solved on upstream (https://github.com/ankitects/anki/pull/2005)\r\n\r\n1. Enable the new backend (Settings > Advanced)\r\n2. Deck picker > Three dot menu > Import > Text file\r\n3. Select a CSV file (I've tested with Anking, pretty heavy and popular deck)\r\n    - Here's a mini version (23KB) if anyone wants to test it: [MiniAnking.txt](https://github.com/ankidroid/Anki-Android/files/9383917/MiniAnking.txt)\r\n    - And here's a slightly cut version (GitHub only allows files up to 25MB): \r\n[Anking.txt](https://github.com/ankidroid/Anki-Android/files/9383942/Anking.txt)\r\n4. Configure anything on the CSV importer\r\n5. Tap Import\r\n\r\n\r\nhttps://user-images.githubusercontent.com/69634269/185787227-5df94718-f6d4-472a-8301-159f4628110d.mp4\r\n\r\n\r\n\r\n## Checklist\r\n_Please, go through these checks before submitting the PR._\r\n\r\n- [X] You have not changed whitespace unnecessarily (it makes diffs hard to read)\r\n- [X] You have a descriptive commit message with a short title (first line, max 50 chars).\r\n- [X] Your code follows the style of the project (e.g. never omit braces in `if` statements) \r\n- [X] You have commented your code, particularly in hard-to-understand areas\r\n- [X] You have performed a self-review of your own code\r\n- [X] UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)\r\n- [ ] UI Changes: You have tested your change using the [Google Accessibility Scanner](https://play.google.com/store/apps/details?id=com.google.android.apps.accessibility.auditor)\r\n",
    "closed_by": {
        "login": "mikehardy",
        "id": 782704,
        "node_id": "MDQ6VXNlcjc4MjcwNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/782704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mikehardy",
        "html_url": "https://github.com/mikehardy",
        "followers_url": "https://api.github.com/users/mikehardy/followers",
        "following_url": "https://api.github.com/users/mikehardy/following{/other_user}",
        "gists_url": "https://api.github.com/users/mikehardy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mikehardy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mikehardy/subscriptions",
        "organizations_url": "https://api.github.com/users/mikehardy/orgs",
        "repos_url": "https://api.github.com/users/mikehardy/repos",
        "events_url": "https://api.github.com/users/mikehardy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mikehardy/received_events",
        "type": "User",
        "site_admin": false
    },
    "reactions": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/12105/reactions",
        "total_count": 3,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 2,
        "confused": 0,
        "heart": 1,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/12105/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}