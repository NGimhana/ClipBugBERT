{
    "url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/11540",
    "repository_url": "https://api.github.com/repos/ankidroid/Anki-Android",
    "labels_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/11540/labels{/name}",
    "comments_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/11540/comments",
    "events_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/11540/events",
    "html_url": "https://github.com/ankidroid/Anki-Android/pull/11540",
    "id": 1261019596,
    "node_id": "PR_kwDOAHXAE845H-IH",
    "number": 11540,
    "title": "Fix `follow system dark mode` on custom/auto schedule",
    "user": {
        "login": "BrayanDSO",
        "id": 69634269,
        "node_id": "MDQ6VXNlcjY5NjM0MjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/69634269?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BrayanDSO",
        "html_url": "https://github.com/BrayanDSO",
        "followers_url": "https://api.github.com/users/BrayanDSO/followers",
        "following_url": "https://api.github.com/users/BrayanDSO/following{/other_user}",
        "gists_url": "https://api.github.com/users/BrayanDSO/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/BrayanDSO/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/BrayanDSO/subscriptions",
        "organizations_url": "https://api.github.com/users/BrayanDSO/orgs",
        "repos_url": "https://api.github.com/users/BrayanDSO/repos",
        "events_url": "https://api.github.com/users/BrayanDSO/events{/privacy}",
        "received_events_url": "https://api.github.com/users/BrayanDSO/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/milestones/42",
        "html_url": "https://github.com/ankidroid/Anki-Android/milestone/42",
        "labels_url": "https://api.github.com/repos/ankidroid/Anki-Android/milestones/42/labels",
        "id": 6623046,
        "node_id": "MDk6TWlsZXN0b25lNjYyMzA0Ng==",
        "number": 42,
        "title": "2.16 release",
        "description": "",
        "creator": {
            "login": "mikehardy",
            "id": 782704,
            "node_id": "MDQ6VXNlcjc4MjcwNA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/782704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mikehardy",
            "html_url": "https://github.com/mikehardy",
            "followers_url": "https://api.github.com/users/mikehardy/followers",
            "following_url": "https://api.github.com/users/mikehardy/following{/other_user}",
            "gists_url": "https://api.github.com/users/mikehardy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mikehardy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mikehardy/subscriptions",
            "organizations_url": "https://api.github.com/users/mikehardy/orgs",
            "repos_url": "https://api.github.com/users/mikehardy/repos",
            "events_url": "https://api.github.com/users/mikehardy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mikehardy/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 4,
        "closed_issues": 3585,
        "state": "open",
        "created_at": "2021-04-04T15:15:20Z",
        "updated_at": "2023-08-28T20:58:04Z",
        "due_on": null,
        "closed_at": null
    },
    "comments": 5,
    "created_at": "2022-06-05T10:53:16Z",
    "updated_at": "2022-06-05T20:03:15Z",
    "closed_at": "2022-06-05T20:00:54Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "draft": false,
    "pull_request": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/pulls/11540",
        "html_url": "https://github.com/ankidroid/Anki-Android/pull/11540",
        "diff_url": "https://github.com/ankidroid/Anki-Android/pull/11540.diff",
        "patch_url": "https://github.com/ankidroid/Anki-Android/pull/11540.patch",
        "merged_at": "2022-06-05T20:00:54Z"
    },
    "body": "## Purpose / Description\r\nBeta is coming, time to pay for my sins and fix my errors.\r\n\r\n## Fixes\r\nFixes #10619\r\n\r\n## Approach\r\nOn learning \u2193\r\n\r\n## How Has This Been Tested?\r\n\r\n\r\nhttps://user-images.githubusercontent.com/69634269/172047099-361b80e6-3e25-4c4e-9519-1c2afa398be8.mp4\r\n\r\n\r\n\r\n## Learning (optional, can help others)\r\n\r\nIf you want to create a light/dark theme, you just need to use one of the `.DayNight` theme variantes as your theme's parent, then create a `values-night` (even Google is inconsitent with `light/dark` and `day/night` naming) folder where you should put your dark variant of the theme, which should have the same name of the light one.\r\n\r\nThen use https://developer.android.com/reference/androidx/appcompat/app/AppCompatDelegate#setDefaultNightMode(int) to tell if you want to follow system, always light or always dark\r\n\r\nThis works quite well if you ***DON'T want to mix themes***, i.e. your light theme will always be paired with the same night theme\r\n\r\nIf that's not your case, like it's not ours (we want the user to use any theme combinations they want), you have to detect yourself which mode the system is on. You just need to do this:\r\n```kotlin\r\ncontext.resources.configuration.uiMode.and(Configuration.UI_MODE_NIGHT_MASK) == Configuration.UI_MODE_NIGHT_YES\r\n```\r\nSome apps use it and it works like a charm.\r\n\r\nBBBBBBBBBBuuuuuuuuuut, for some reason it doesn't work perfectly on AnkiDroid, yaaaaaaaaayyyyyyyyyyy. The problem is that `uiMode` isn't updated if `dark mode` is changed and AnkiDroid is open and I don't know why.\r\n- As I said, it works on other apps and on a dummy project as well\r\n- Not a context level problem (tested with context, applicationContext and baseContext)\r\n- Not a lifecycle problem (doesn't matter if it's `onCreate`, before `setContentView` or whatever)\r\n\r\nSo to fix it, I relied on `uiModeManager`, which does update with `dark mode` changes. But `uiModeManager` is an older API that can't tell if `auto` or `custom` schedule is using light or dark mode. Therefore, `uiMode` still to be used on these cases. Now auto/custom schedule will work, which is some progress, with the caveat of having to reopen the app if the user changes to them while the app is open.\r\n\r\nThe result isn't the ideal one, but will handle most of the cases, so I consider it a step forward\r\n\r\nP.S.: IMHO, definetely not a pleasant API\r\n\r\nP.S.2: Now that I look again at it after 2 months, my code isn't pleasant as well. Should be refactoring it as well soon because I need some themes tweaks to my preferences project\r\n\r\n## Checklist\r\n_Please, go through these checks before submitting the PR._\r\n\r\n- [X] You have not changed whitespace unnecessarily (it makes diffs hard to read)\r\n- [X] You have a descriptive commit message with a short title (first line, max 50 chars).\r\n- [X] Your code follows the style of the project (e.g. never omit braces in `if` statements) \r\n- [X] You have commented your code, particularly in hard-to-understand areas\r\n- [X] You have performed a self-review of your own code\r\n- [ ] UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)\r\n- [ ] UI Changes: You have tested your change using the [Google Accessibility Scanner](https://play.google.com/store/apps/details?id=com.google.android.apps.accessibility.auditor)\r\n",
    "closed_by": {
        "login": "mikehardy",
        "id": 782704,
        "node_id": "MDQ6VXNlcjc4MjcwNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/782704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mikehardy",
        "html_url": "https://github.com/mikehardy",
        "followers_url": "https://api.github.com/users/mikehardy/followers",
        "following_url": "https://api.github.com/users/mikehardy/following{/other_user}",
        "gists_url": "https://api.github.com/users/mikehardy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mikehardy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mikehardy/subscriptions",
        "organizations_url": "https://api.github.com/users/mikehardy/orgs",
        "repos_url": "https://api.github.com/users/mikehardy/repos",
        "events_url": "https://api.github.com/users/mikehardy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mikehardy/received_events",
        "type": "User",
        "site_admin": false
    },
    "reactions": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/11540/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/11540/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}