{
    "url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/9765",
    "repository_url": "https://api.github.com/repos/ankidroid/Anki-Android",
    "labels_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/9765/labels{/name}",
    "comments_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/9765/comments",
    "events_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/9765/events",
    "html_url": "https://github.com/ankidroid/Anki-Android/pull/9765",
    "id": 1044031740,
    "node_id": "PR_kwDOAHXAE84uDyQp",
    "number": 9765,
    "title": "[EditNote][DeckSelectionDialog] Highlight Selected item",
    "user": {
        "login": "codingtosh",
        "id": 81802035,
        "node_id": "MDQ6VXNlcjgxODAyMDM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/81802035?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/codingtosh",
        "html_url": "https://github.com/codingtosh",
        "followers_url": "https://api.github.com/users/codingtosh/followers",
        "following_url": "https://api.github.com/users/codingtosh/following{/other_user}",
        "gists_url": "https://api.github.com/users/codingtosh/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/codingtosh/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/codingtosh/subscriptions",
        "organizations_url": "https://api.github.com/users/codingtosh/orgs",
        "repos_url": "https://api.github.com/users/codingtosh/repos",
        "events_url": "https://api.github.com/users/codingtosh/events{/privacy}",
        "received_events_url": "https://api.github.com/users/codingtosh/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/milestones/42",
        "html_url": "https://github.com/ankidroid/Anki-Android/milestone/42",
        "labels_url": "https://api.github.com/repos/ankidroid/Anki-Android/milestones/42/labels",
        "id": 6623046,
        "node_id": "MDk6TWlsZXN0b25lNjYyMzA0Ng==",
        "number": 42,
        "title": "2.16 release",
        "description": "",
        "creator": {
            "login": "mikehardy",
            "id": 782704,
            "node_id": "MDQ6VXNlcjc4MjcwNA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/782704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mikehardy",
            "html_url": "https://github.com/mikehardy",
            "followers_url": "https://api.github.com/users/mikehardy/followers",
            "following_url": "https://api.github.com/users/mikehardy/following{/other_user}",
            "gists_url": "https://api.github.com/users/mikehardy/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mikehardy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mikehardy/subscriptions",
            "organizations_url": "https://api.github.com/users/mikehardy/orgs",
            "repos_url": "https://api.github.com/users/mikehardy/repos",
            "events_url": "https://api.github.com/users/mikehardy/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mikehardy/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 4,
        "closed_issues": 3585,
        "state": "open",
        "created_at": "2021-04-04T15:15:20Z",
        "updated_at": "2023-08-28T20:58:04Z",
        "due_on": null,
        "closed_at": null
    },
    "comments": 0,
    "created_at": "2021-11-03T19:36:05Z",
    "updated_at": "2021-11-08T13:41:47Z",
    "closed_at": "2021-11-08T12:39:27Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "draft": false,
    "pull_request": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/pulls/9765",
        "html_url": "https://github.com/ankidroid/Anki-Android/pull/9765",
        "diff_url": "https://github.com/ankidroid/Anki-Android/pull/9765.diff",
        "patch_url": "https://github.com/ankidroid/Anki-Android/pull/9765.patch",
        "merged_at": "2021-11-08T12:39:27Z"
    },
    "body": "## Purpose / Description\r\nThe selected deck item of the deck spinner is not highlighted in the deck selection dialog. This is inconsistent from the behaviour of the noteTypeSpinner and a design flaw. This PR fixes that issue by highlighting the aforementioned.\r\n\r\n## Fixes   #9755\r\n\r\n\r\nhttps://user-images.githubusercontent.com/81802035/140179674-ae7948d5-972a-4247-8a57-f64349b46c94.mp4\r\n\r\n\r\nhttps://user-images.githubusercontent.com/81802035/140179691-a4c396ea-d8bc-46fb-8dcf-c58bebdc51d2.mp4\r\n\r\n\r\n\r\n## Approach\r\n1. Retrieve the Spinner text, this is the name of the selected deck item.\r\n2. In the RecyclerView DecksArrayAdapter, override OnBindViewHolder to compare the Spinner Text with the viewHolder's Item name(this would be the deck item in the RecyclerView of the DeckSelectionDialog).\r\n3. If equal, highlight the textView item, else set default colors. \r\n\r\n## How Has This Been Tested?\r\nThis was manually tested  in API 30, both night  mode disbaled and enabled.\r\n\r\n## Learning (optional, can help others)\r\n1. NoteEditor: mDeckspinnerSelection.initializeNoteEditorDeckSpinner() is called\r\n\r\n2. DeckSpinnerSelection: getDropDownView() is overriden to highlight the spinner selected item. This is supposed to implement the desired behaviour, but it doesn't. So this was inspected further. \r\n\r\n3. It was found that OnItemSelectedListener was not implemented anywhere for the adapter. It was tried but did not produce any results.\r\n\r\n4. After some debugging, it was concluded that the code does reach initializeNoteEditorDeckSpinner(). Also, getView() was able to be overridden in #9756, which corroborates the fact that the code does reach initializeNoteEditorDeckSpinner(). The indication here is that perhaps the code doesn't reach only getDropDownView() from the NoteEditor activity.\r\n\r\n5. This was inspected and it was found to be the case. This means that the drop down view is never created, however we already know that the deck names are visible in the dialog in the UI, this means that something else is responsible for creating the view. Since spinner mode is never even set to dialog, it is now concluded that the dialog is created elsewhere.\r\n \r\n6. Surely enough, upon inspection of NoteEditor, it was found that a custom DeckSelectionDialog was implemented to display the deck collection. This indicated why getDropDownView() was not getting called, as we don't have a drop down view in the first place.\r\n \r\n7. DeckSelectionDialog was inspected and RecyclerView was found to populate the UI with the deck names. From here, now we only needed to set setBackgroundColor of the itemView of the ViewHolder object when overriding onBindViewHolder() method.\r\n  \r\n8. But to determine which the selected Item was, we needed to know the position of the selected deck item. The code was inspected, and no particular position field/getter method was found. However, there was a getter method for the deckId. Now we just needed to match this with the mCurrentDid from the NoteEditor activity. Since passing the mCurrentDid from the activity to the fragment led to tight coupling between them, this introduced other challanges, alternate approach was needed to simplify.\r\n  \r\n9. Instead of passing mCurrentDid, we could directly inspect the Spinner view of the NoteEditor Activity from within the fragment itself. Then we could match the text from Spinner View(which displays the selected item) with the name of the deck in the viewholder of the dialog's recyclerView. getName() was found to exist and was used to retrieve the name of the deck in the viewholder. If  the strings are equal, highlight the viewholder, if not,  set the viewholder bgcolor transparent. This worked well, but upon manual testing, it was found that in night mode, the text color remained white even in the selected background color, which was not desirable. We needed the same colors as in the noteTypeSpinner drop down view for consistency.  \r\n\r\n10. To fix this, NoteTypeSpinnerUtils was inspected and the selected/unslected text/background color were reused. To set the textColor, mDeckTextView had to be used. At this point, it was decided that rather than setting the background color through the itemView, mDeckTextView could be used directly.\r\n\r\n11. Next, there were some hiccups in using the android textColorPrimary and colorBackground attributes in the java code. So the kotlin byte code was decompiled and it was found that Themes.getColorFromAttr had to be used in the java code.\r\n\r\nAfter implementing the above, the desired consistent behaviour was achieved, both when nightmode is enabled or disabled.\r\n\r\n## Checklist\r\n_Please, go through these checks before submitting the PR._\r\n\r\n- [x] You have not changed whitespace unnecessarily (it makes diffs hard to read)\r\n- [x] You have a descriptive commit message with a short title (first line, max 50 chars).\r\n- [x] Your code follows the style of the project (e.g. never omit braces in `if` statements) \r\n- [ ] You have commented your code, particularly in hard-to-understand areas\r\n- [x] You have performed a self-review of your own code\r\n- [x] UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)\r\n- [ ] UI Changes: You have tested your change using the [Google Accessibility Scanner](https://play.google.com/store/apps/details?id=com.google.android.apps.accessibility.auditor)\r\n",
    "closed_by": {
        "login": "mikehardy",
        "id": 782704,
        "node_id": "MDQ6VXNlcjc4MjcwNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/782704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mikehardy",
        "html_url": "https://github.com/mikehardy",
        "followers_url": "https://api.github.com/users/mikehardy/followers",
        "following_url": "https://api.github.com/users/mikehardy/following{/other_user}",
        "gists_url": "https://api.github.com/users/mikehardy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mikehardy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mikehardy/subscriptions",
        "organizations_url": "https://api.github.com/users/mikehardy/orgs",
        "repos_url": "https://api.github.com/users/mikehardy/repos",
        "events_url": "https://api.github.com/users/mikehardy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mikehardy/received_events",
        "type": "User",
        "site_admin": false
    },
    "reactions": {
        "url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/9765/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/ankidroid/Anki-Android/issues/9765/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}